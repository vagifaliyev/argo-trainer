#va719 - Vagif R. Aliyev 
from argopy import DataFetcher as ArgoDataFetcher
import random 
import pandas as pd
import csv  
import os
import glob

#list of known float numbers 
list_float = [1901155,1901298,1901324,1901341,1901604,1901685,1901689,1901694,1901710,1901711,1901712,1901713,
1901716,1901717,1901719,1901720,1901721,1901722,1901727,1901730,1901733,1901784,
1901790,1901806,1901807,1901814,1901815,1901816,1901817,1901818,1901819,1901820,1901822,1901824,1901825,1901826,1901827,
1901828,1901829,1901830,1901836,1901849,1901851,1901854,1901855,1901856,1901857,1901865,1901866,1901867,1901868,1901870,1901876,
1901877,1901878,1901879,1901880,1901882,1901883,1901885,1901886,1901887,1901894,1901896,1901915,1901916,1901917,1902060,
1902061,1902062,1902063,1902064,1902065,1902066,1902067,1902068,1902069,1902070,1902071,1902072,1902073,1902180,1902182,
1902183,1902184,1902204,1902205,1902206,1902207,1902208,1902209,1902210,1902211,1902220,1902227,1902228,1902274,2901300,
2901904,2902169,3900559,3901037,3901038,3901039,3901040,3901041,3901064,3901108,3901110,3901111,
3901116,3901211,3901219,3901220,3901226,3901236,3901237,3901238,3901239,3901240,
3901241,3901242,3901297,3901310,3901311,3901312,3901496,3901513,3901515,3901519,3901521,3901522,3901523,3901525,3901526,
3901534,3901536,3901537,3901546,3901547,3901549,3901550,3901551,3901554,3901597,3901598,3901601,
3901602,3901603,3901604,3901605,3901606,3901607,3901609,3901610,3901611,3901619,3901622,3901623,3901624,
3901625,3901626,3901627,3901628,3901629,3901630,3901631,3901632,3901633,3901634,3901635,3901637,
3901640,3901642,3901643,3901644,3901646,3901650,3901651,3901652,3901653,3901654,3901656,3901657,3901658,
3901659,3901660,3901661,3901662,3901663,3901665,3901666,3901668,3901669,3901670,3901671,3901672,3901673,3901674,
3901675,3901677,3901679,3901680,3901681,3901683,3901684,3901685,3901686,3901687,3901819,3901820,3901821,
3901822,3901823,3901827,3901828,3901829,3901830,3901832,3901833,3901834,3901835,3901836,3901838,3901839,
3901840,3901841,3901843,3901844,3901845,3901846,3901847,3901849,3901850,3901851,3901852,3901853,
3901854,3901855,3901856,3901857,3901858,3901859,3901860,3901861,3901864,3901865,3901866,3901867,3901868,
3901869,3901870,3901871,3901872,3901873,3901875,3901876,3901878,3901880,3901881,3901882,3901884,3901887,
3901888,3901891,3901892,3901893,3901895,3901896,3901898,3901901,3901903,3901908,3901909,
3901911,3901915,3901918,3901919,3901921,3901922,3901926,3901929,3901930,3901931,3901932,3901933,3901934,
3901935,3901937,3901938,3901939,3901942,3901943,3901944,3901945,3901946,3901947,3901948,3901949,3901950,
3901951,3901954,3901955,3901956,3901957,3901961,3901963,3901964,3901965,3901967,3901968,
3901969,3901970,3901971,3901972,3901975,3901976,3901977,3901978,3901979,3901980,3901982,3901983,
3901984,3901985,3901986,3901987,3901988,3901989,3901990,3901991,3901992,3902102,3902103,3902106,3902107,
3902108,3902109,3902110,3902120,3902121,3902122,3902123,3902124,3902125,3902127,3902128,3902131,3902135,
3902137,3902148,3902149,3902150,3902151,3902152,3902153,3902154,3902155,3902156,3902157,3902159,3902160,
3902161,3902162,3902163,3902166,3902168,3902169,3902201,3902202,3902203,3902204,3902206,3902207,3902208,
3902209,3902213,3902214,3902215,3902218,3902235,3902236,3902237,3902238,3902240,3902241,3902243,3902244,
3902245,3902398,3902399,3902400,3902402,3902403]

#if file has already been dowloaded before, dont do it again 
#change path according to your own machine 
path = r'./'
extension = 'csv'
os.chdir(path)
already_done = [x.rsplit(".csv", 1)[0] for x in glob.glob('*.{}'.format(extension))]

#using list comprehension to convert string values to int 
already_done = [int(i) for i in already_done]

#update the list without the files already saved
list_float = [x for x in list_float if x not in already_done]

#print(list_float)

print('----------------------------------------------')

# save as single argo float
def main():
    unsaved = []
    for i in list_float:
        try:
            argo_loader = ArgoDataFetcher()
            
            #access certain data and profile 
            ds = argo_loader.float(i).to_xarray()
            #conver to Panda
            df = ds.to_dataframe()

            # entries with qc flag of 1 for Pressure and Temo
            # if not 1, remove row
            df = df[df.PSAL_QC == 1]
            df = df[df.TEMP_QC == 1]
            #print(df)

            #if dataframe not empty save
            if not df.empty:
                with open(str(i)+'.csv', 'w') as f:
                    df.to_csv(f, header=f.tell()==0)
                print('> ' + str(i) + '.csv saved.')
            else:
                print('> ' + str(i) + '.csv not saved as it is empty.')

        # some floats contain bad data and can not be saved
        # notify the user and make a list 
        except:
            print('> file could not be saved '+str(i))
            unsaved.append(i)
            pass
    print('Number of unsaved floats:', len(unsaved))
    
#call main function
main()
print('---------------------DONE---------------------')